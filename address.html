<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Address Page</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
body { background-color: #f8f9fa; }
.address-box { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.address-selected { background-color: #eef0f3; }
.btn-purple { background-color: #070707; color: white; }
.btn-purple:hover { background-color: #80434b; }
.edit-link { color: #800080; cursor: pointer; }
</style>
</head>
<body>

<div class="container my-4">
  <div class="row g-4">
    <div class="col-lg-8">
      <h5>Select Delivery Address</h5>
      <div id="addresses"></div>
      <button class="btn btn-link text-primary" onclick="showAddAddress()">+ ADD NEW ADDRESS</button>

      <div id="add-address-form" style="display:none;" class="mt-2">
        <input type="text" id="new-name" class="form-control mb-2" placeholder="Enter Name"/>
        <input type="text" id="new-phone" class="form-control mb-2" placeholder="Enter Phone"/>
        <textarea id="new-address" class="form-control mb-2" placeholder="Enter Address"></textarea>
        <button class="btn btn-purple" type="button" onclick="addAddress()">Save Address</button>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="address-box">
        <h6>Price Details</h6>
        <hr>
        <p>Total Product Price: <span id="total-price">₹0</span></p>
        <p>Total Discounts: <span id="total-discount">-₹0</span></p>
        <p>Delivery Charges: ₹150</p>
        <hr>
        <p><strong>Order Total:</strong> <span id="order-total">₹0</span></p>
        <p style="color:green;" id="saved-amount">Yay! You saved ₹0</p>
        <button class="btn btn-purple w-100" onclick="proceedToPayment()">Deliver to this Address</button>
      </div>
    </div>
  </div>
</div>

<script>
const defaultAddresses = [
  {name:"Sherlock Holmes", phone:"1234567890", address:"221B Baker Street, London, UK"},
  {name:"Homer Simpson", phone:"9876543210", address:"742 Evergreen Terrace, Springfield, USA"},
  {name:"Prime Minister", phone:"1122334455", address:"10 Downing Street, Westminster, London, UK"}
];

// Initialize localStorage ONLY if it's empty
if(!localStorage.getItem('addresses')) {
  localStorage.setItem('addresses', JSON.stringify(defaultAddresses));
}

function getAddresses() {
  return JSON.parse(localStorage.getItem('addresses') || "[]");
}

function saveAddresses(addresses) {
  localStorage.setItem('addresses', JSON.stringify(addresses));
}

function loadAddresses() {
  const container = document.getElementById('addresses');
  container.innerHTML = '';
  const addresses = getAddresses();

  addresses.forEach((addr, index) => {
    container.innerHTML += `
      <div class="address-box" id="address-${index}">
        <input type="radio" name="address" id="radio-${index}" value="${index}" ${index===0?'checked':''} onclick="selectAddress(${index})"/>
        <label for="radio-${index}">
          <strong>${addr.name}</strong><br>
          ${addr.phone}<br>
          ${addr.address}<br>
          <span class="edit-link" onclick="editAddress(${index})">EDIT</span>
        </label>
      </div>
    `;
  });

  selectAddress(0);
}

function selectAddress(index) {
  document.querySelectorAll('.address-box').forEach(box => box.classList.remove('address-selected'));
  const selectedBox = document.getElementById(`address-${index}`);
  if(selectedBox) selectedBox.classList.add('address-selected');
}

function showAddAddress() {
  document.getElementById('add-address-form').style.display = 'block';
}

function addAddress() {
  const name = document.getElementById('new-name').value.trim();
  const phone = document.getElementById('new-phone').value.trim();
  const address = document.getElementById('new-address').value.trim();
  if(!name || !phone || !address) {
    alert("Please fill all fields");
    return;
  }

  const addresses = getAddresses();
  addresses.push({name, phone, address});
  saveAddresses(addresses);

  document.getElementById('new-name').value='';
  document.getElementById('new-phone').value='';
  document.getElementById('new-address').value='';
  document.getElementById('add-address-form').style.display='none';
  loadAddresses();
}

function editAddress(index) {
  const addresses = getAddresses();
  const addr = addresses[index];
  const newName = prompt("Edit Name:", addr.name);
  if(!newName) return;
  const newPhone = prompt("Edit Phone:", addr.phone);
  if(!newPhone) return;
  const newAddress = prompt("Edit Address:", addr.address);
  if(!newAddress) return;

  addresses[index] = {name:newName, phone:newPhone, address:newAddress};
  saveAddresses(addresses);
  loadAddresses();
}

function proceedToPayment() {
  const selected = document.querySelector('input[name="address"]:checked');
  if(!selected) { alert("Please select an address."); return; }
  localStorage.setItem('selectedAddressIndex', selected.value);
  window.location.href = "payment.html";
}

function loadPriceDetails() {
  document.getElementById('total-price').innerText = localStorage.getItem('totalPrice') || "₹0";
  document.getElementById('total-discount').innerText = localStorage.getItem('totalDiscount') || "-₹0";
  document.getElementById('order-total').innerText = localStorage.getItem('orderTotal') || "₹0";
  document.getElementById('saved-amount').innerText = "Yay! You saved " + (localStorage.getItem('totalDiscount') || "₹0");
}

document.addEventListener('DOMContentLoaded', ()=>{
  loadPriceDetails();
  loadAddresses();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
